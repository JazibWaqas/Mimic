================================================================================
TESTING REF5.MP4 WITH VIBES + DYNAMIC BPM
================================================================================

üìπ Reference: ref5.mp4
   Duration: 16.65s

üìé Testing with 20 clips
   Cache Version: 6.0 (will re-analyze clips for vibes)

üöÄ Starting pipeline...
   Step 1: Validating inputs
   Step 2: Scene detection + BPM detection + Reference analysis
   Step 3: Clip analysis (NEW: extracting vibes + content)
   Step 4: Semantic matching (NEW: vibe-aware selection)
   Step 5: Rendering with dynamic BPM sync


[1/5] Validating inputs...

[2/5] Detecting visual cuts and analyzing reference structure...
  [DIAGNOSTIC] Detecting visual scene changes (threshold=0.3)...
  [OK] Detected 20 visual cuts.
  [OK] Audio extracted: ref_analysis_audio.wav
  [BEAT] Detecting BPM for ref_analysis_audio.wav...
  [OK] Detected BPM: 0.00

============================================================
[BRAIN] ANALYZING REFERENCE VIDEO: ref5.mp4
[BRAIN] Using 20 visual scene anchors.
============================================================

[BRAIN] Creating muted copy for analysis: C:\Users\OMNIBOOK\Documents\GitHub\Mimic\data\cache\muted_d04cf94d4d8a.mp4
[API KEY MANAGER] Loaded 28 API key(s)
[API KEY MANAGER] Current key: AIzaSyD-i-...fqpqg
[OK] Using model: gemini-3-flash-preview
Uploading muted_d04cf94d4d8a.mp4...
Waiting for video processing (state: PROCESSING)...
Upload complete: https://generativelanguage.googleapis.com/v1beta/files/fladsk1yd9si
[RETRY DEBUG] Reference analysis attempt 1 failed: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 20, model: gemini-3-flash
Please retry in 36.430666728s. [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-3-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 20
}
, retry_delay {
  seconds: 36
}
]
[QUOTA] Rate limit detected during reference analysis
[API KEY MANAGER] Marking key as exhausted: AIzaSyD-i-...fqpqg (Rate limit during reference analysis)
[API KEY MANAGER] Rotated to key 2/28: AIzaSyAjP3...SS5Pk
[QUOTA] Rotated to new API key, re-initializing genai...
[OK] Using model: gemini-3-flash-preview
Uploading muted_d04cf94d4d8a.mp4...
Waiting for video processing (state: PROCESSING)...
Upload complete: https://generativelanguage.googleapis.com/v1beta/files/z8l7hbnses5w
[WARN] Attempting to repair malformed JSON...
[RETRY DEBUG] Reference analysis attempt 2 failed: Failed to parse or repair JSON: Expecting value: line 1 column 1 (char 0)
Raw: The provided video has been segmented into 21 parts based on scene cuts, and each segment has been analyzed for camera movement speed and dynamics. The resulting codes are as follows: MD, MD, LS, LS, LS, LS, LS, LS, LS, LS, LS, LS, LS, LS, LS, LS, LS, MD, MD, MD, MD.
[OK] Using model: gemini-3-flash-preview
Uploading muted_d04cf94d4d8a.mp4...
Waiting for video processing (state: PROCESSING)...
Upload complete: https://generativelanguage.googleapis.com/v1beta/files/3ylgbic95uic
[BRAIN] Reconstructing from codes: MD, MD, LD, LS, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD, MD
[SUBDIVISION] 21 segments -> 23 segments (max 2.0s each)
[OK] Analysis complete: 23 segments.
[OK] Gemini successfully analyzed reference: 23 segments found.

[3/5] Analyzing user clips with Gemini AI...

============================================================
[BRAIN] ANALYZING USER CLIPS (20 total)
[BRAIN] Mode: COMPREHENSIVE (energy + best moments)
============================================================

[OK] Using model: gemini-3-flash-preview

[1/20] Processing clip.mp4
  Analyzing comprehensively: clip.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Humor, Indoor

[2/20] Processing clip1.mp4
  Analyzing comprehensively: clip1.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Nature, Friends, Fun

[3/20] Processing clip10.mp4
  Analyzing comprehensively: clip10.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Nature, Friends, Dance

[4/20] Processing clip11.mp4
  Analyzing comprehensively: clip11.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Action, Travel, Thrill

[5/20] Processing clip12.mp4
  Analyzing comprehensively: clip12.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Action, Outdoors, Travel

[6/20] Processing clip13.mp4
  Analyzing comprehensively: clip13.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Nature, Travel, Winter, Friends

[7/20] Processing clip14.mp4
  Analyzing comprehensively: clip14.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Travel, Adventure, Nature

[8/20] Processing clip15.mp4
  Analyzing comprehensively: clip15.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Funny, Travel, Candid

[9/20] Processing clip16.mp4
  Analyzing comprehensively: clip16.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Nightlife, Fun, Music

[10/20] Processing clip17.mp4
  Analyzing comprehensively: clip17.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Nightlife, Fun

[11/20] Processing clip18.mp4
  Analyzing comprehensively: clip18.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Urban, Friends, Night, Action

[12/20] Processing clip19.mp4
  Analyzing comprehensively: clip19.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Night, Action, Travel

[13/20] Processing clip2.mp4
  Analyzing comprehensively: clip2.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Action, Fun

[14/20] Processing clip3.mp4
  Analyzing comprehensively: clip3.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Casual, Humorous

[15/20] Processing clip4.mp4
  Analyzing comprehensively: clip4.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Casual, Fun

[16/20] Processing clip5.mp4
  Analyzing comprehensively: clip5.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Music, Fun

[17/20] Processing clip6.mp4
  Analyzing comprehensively: clip6.mp4...
    [CACHE] Loaded: High/Dynamic with 3 best moments
    [CACHE] Vibes: Party, Friends, Celebration, Dance

[18/20] Processing clip7.mp4
  Analyzing comprehensively: clip7.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Friends, Urban, Casual

[19/20] Processing clip8.mp4
  Analyzing comprehensively: clip8.mp4...
    [CACHE] Loaded: Low/Dynamic with 3 best moments
    [CACHE] Vibes: Nature, Travel, Calm

[20/20] Processing clip9.mp4
  Analyzing comprehensively: clip9.mp4...
    [CACHE] Loaded: Medium/Dynamic with 3 best moments
    [CACHE] Vibes: Action, Water, Outdoors

[OK] All 20 clips analyzed
[OK] Rate limiter status: 0 requests in last minute

[OK] Gemini successfully analyzed 20 clips (using originals for cache).
  Standardizing clip 1/20...
  [OK] Standardized: clip_001.mp4
  Standardizing clip 2/20...
  [OK] Standardized: clip_002.mp4
  Standardizing clip 3/20...
  [OK] Standardized: clip_003.mp4
  Standardizing clip 4/20...
  [OK] Standardized: clip_004.mp4
  Standardizing clip 5/20...
  [OK] Standardized: clip_005.mp4
  Standardizing clip 6/20...
  [OK] Standardized: clip_006.mp4
  Standardizing clip 7/20...
  [OK] Standardized: clip_007.mp4
  Standardizing clip 8/20...
  [OK] Standardized: clip_008.mp4
  Standardizing clip 9/20...
  [OK] Standardized: clip_009.mp4
  Standardizing clip 10/20...
  [OK] Standardized: clip_010.mp4
  Standardizing clip 11/20...
  [OK] Standardized: clip_011.mp4
  Standardizing clip 12/20...
  [OK] Standardized: clip_012.mp4
  Standardizing clip 13/20...
  [OK] Standardized: clip_013.mp4
  Standardizing clip 14/20...
  [OK] Standardized: clip_014.mp4
  Standardizing clip 15/20...
  [OK] Standardized: clip_015.mp4
  Standardizing clip 16/20...
  [OK] Standardized: clip_016.mp4
  Standardizing clip 17/20...
  [OK] Standardized: clip_017.mp4
  Standardizing clip 18/20...
  [OK] Standardized: clip_018.mp4
  Standardizing clip 19/20...
  [OK] Standardized: clip_019.mp4
  Standardizing clip 20/20...
  [OK] Standardized: clip_020.mp4
[OK] All clips standardized and ready for render.

[4/5] Creating edit sequence...

============================================================
[EDITOR] MATCHING CLIPS TO BLUEPRINT (FIXED VERSION)
============================================================
  Segments: 23
  Clips: 20
  Clips with pre-computed best moments: 20/20

============================================================
[ERROR] PIPELINE FAILED
============================================================
Error: float division by zero
============================================================


================================================================================
‚ùå FAILED
   Error: float division by zero
================================================================================
